<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Tatouables - Artiste Tatoueur Professionnel</title>
    <meta name="description" content="Les Tatouables - Artiste tatoueur professionnel. Découvrez mes créations uniques et réservez votre séance de tatouage.">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>Les Tatouables</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="#accueil" class="nav-link">Accueil</a></li>
                <li><a href="#s'inkolor" class="nav-link">À propos de S'inkolor</a></li>
                <li><a href="#ldermo" class="nav-link">À propos de LDermo</a></li>
                <li><a href="#portfolio" class="nav-link">Portfolio</a></li>
                <li><a href="#flash" class="nav-link">Flash</a></li>
                <li><a href="#contact" class="nav-link">Contact</a></li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="accueil" class="hero">
        <div class="hero-content">
            <h1 class="hero-title">Les Tatouables</h1>
            <p class="hero-subtitle">Salon De Tatoueurs Professionnels</p>
            <div class="hero-buttons">
                <a href="#portfolio" class="btn btn-primary">Voir nos créations</a>
                <a href="#contact" class="btn btn-secondary">Prendre rendez-vous</a>
            </div>
        </div>
        <div class="hero-image">
            <div class="tattoo-preview">
                <img src="images/logo.png" alt="Les Tatouables - Logo">
            </div>
        </div>
    </section>

    <!-- Artists Section -->
    <section id="tatoueurs" class="artists">
        <div class="container">
            <h2 class="section-title">Nos tatoueurs</h2>
            <p class="section-subtitle">Deux expertises complémentaires</p>
            <div class="artists-grid">
                <article class="artist-card">
                    <div class="artist-info">
                        <h3>S'inkolor</h3>
                        <p>Spécialiste manga, anime et pop culture. Lignes précises, couleurs vibrantes et compositions dynamiques.</p>
                    </div>
                </article>
                <article class="artist-card">
                    <div class="artist-info">
                        <h3>LDermo</h3>
                        <p>Dermopigmentation réparatrice et correctrice. Approche douce, résultats naturels et techniques avancées.</p>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <!-- À propos de LDermo -->
    <section id="ldermo" class="about">
        <div class="container">
            <div class="about-content">
                <div class="about-image">
                    <img src="images/ldermo.jpeg" alt="LDermo - Dermopigmentation" class="about-photo">
                </div>
                <div class="about-text">
                    <h2>À propos de LDermo</h2>
                    <p>Spécialisée en <strong>dermopigmentation réparatrice et correctrice</strong> (aréoles mammaires, cicatrices, vitiligo, densification capillaire), LDermo accompagne chaque personne avec une approche douce et personnalisée.</p>
                    <p>Objectif: des <strong>résultats naturels et harmonieux</strong>, grâce à des techniques avancées, un protocole d’hygiène irréprochable et une écoute attentive.</p>
                    <div class="about-stats">
                        <div class="stat">
                            <h3>5+</h3>
                            <p>Années d'expérience</p>
                        </div>
                        <div class="stat">
                            <h3>300+</h3>
                            <p>Interventions réalisées</p>
                        </div>
                        <div class="stat">
                            <h3>100%</h3>
                            <p>Satisfaction client</p>
                        </div>
                    </div>
                    <a href="#contact" class="btn btn-primary" style="margin-top:1rem; display:inline-block;">Prendre contact</a>
                    <a href="#portfolio-ldermo" class="btn btn-secondary" style="margin-top:1rem; display:inline-block; margin-left:0.5rem;">Voir le portfolio</a>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="s'inkolor"class="about">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <h2>À propos de S'inkolor</h2>
                    <p>Passionné par l'art du tatouage et spécialisé dans les univers <strong>Manga, Disney et Pop Culture</strong>, je crée des œuvres uniques qui reflètent votre personnalité. Chaque projet est une collaboration artistique où vos idées prennent vie sous forme de tatouages durables et esthétiques.</p>
                    <p>Basé à <strong>Toul</strong>, je m'adapte à vos envies pour créer des pièces qui vous ressemblent et vous accompagnent tout au long de votre vie. Mon agenda est ouvert pour <strong>Décembre et Janvier</strong> !</p>
                    <div class="about-stats">
                        <div class="stat">
                            <h3>5+</h3>
                            <p>Années d'expérience</p>
                        </div>
                        <div class="stat">
                            <h3>200+</h3>
                            <p>Tatouages réalisés</p>
                        </div>
                        <div class="stat">
                            <h3>100%</h3>
                            <p>Satisfaction client</p>
                        </div>
                    </div>
                    <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="btn btn-instagram" style="margin-top:1rem; display:inline-block;">
                        <i class="fab fa-instagram"></i> @sinkolor.tattoo
                    </a>
                    <a href="#portfolio-sinkolor" class="btn btn-secondary" style="margin-top:1rem; display:inline-block; margin-left:0.5rem;">Voir le portfolio</a>
                    <a href="#contact" class="btn btn-primary" style="margin-top:1rem; display:inline-block; margin-left:0.5rem;">Prendre contact</a>
                </div>
                <div class="about-image">
                    <img src="images/sinkolor.jpeg" alt="S'inkolor - Artiste Tatoueur" class="about-photo">
                </div>
            </div>
        </div>
    </section>

    <!-- Flash Section -->
    <section id="flash" class="flash">
        <div class="container">
            <h2 class="section-title">Tattoos Flash</h2>
            <p class="section-subtitle">Disponibles dès maintenant.</p>
            <div class="flash-controls" id="flashControls" style="display:flex; justify-content:flex-end;">
                <button id="toggleEditFlash" class="btn btn-secondary" type="button">Gérer</button>
                <button id="addFlash" class="btn btn-primary" type="button" style="display:none;">Ajouter</button>
            </div>
            <div class="flash-grid" id="flashGrid"></div>
            <div class="flash-empty" id="flashEmpty" style="display:none;">Aucun flash disponible.</div>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="portfolio">
        <div class="container">
            <h2 class="section-title">Portfolio</h2>
            <p class="section-subtitle">Découvrez les créations de S'inkolor et LDermo</p>
            
            <!-- S'inkolor -->
            <div id="portfolio-sinkolor" class="portfolio-section">
                <h3 class="section-subtitle" style="margin-top:1rem">S'inkolor</h3>
                <div class="portfolio-grid">
                    

                    <!-- Ajouts S'inkolor images 5 à 17 -->
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image5.jpeg" alt="Tatouage S'inkolor 5" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image6.jpeg" alt="Tatouage S'inkolor 6" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image7.jpeg" alt="Tatouage S'inkolor 7" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image8.jpeg" alt="Tatouage S'inkolor 8" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image9.jpeg" alt="Tatouage S'inkolor 9" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image10.jpeg" alt="Tatouage S'inkolor 10" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image12.jpeg" alt="Tatouage S'inkolor 12" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image13.jpeg" alt="Tatouage S'inkolor 13" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image14.jpeg" alt="Tatouage S'inkolor 14" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image15.jpeg" alt="Tatouage S'inkolor 15" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image16.jpeg" alt="Tatouage S'inkolor 16" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="all">
                        <div class="portfolio-image">
                            <img src="images/image17.jpeg" alt="Tatouage S'inkolor 17" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>S'inkolor</h3>
                            <p>Création</p>
                            <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="portfolio-link"><i class="fab fa-instagram"></i> Voir sur Instagram</a>
                        </div>
                    </div>
                </div>

                <div class="portfolio-cta">
                    
                </div>
            </div>

            <!-- LDermo -->
            <div id="portfolio-ldermo" class="portfolio-section">
                <h3 class="section-subtitle" style="margin-top:2rem">LDermo</h3>
                <div class="portfolio-grid">
                    <div class="portfolio-item" data-category="dermo">
                        <div style="text-align:center; font-weight:600; margin-bottom:8px;">
                            <span style="display:inline-block; padding:6px 10px; background:#f2f2f2; border-radius:999px; color:#333; font-size:0.95rem;">Avant</span>
                        </div>
                        <div class="portfolio-image">
                            <img src="images/image19.jpeg" alt="Avant - Reconstruction mammaire" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>Avant</h3>
                            <p>Reconstruction mammaire</p>
                            <a href="#contact" class="portfolio-link"><i class="fas fa-envelope"></i> Demander infos</a>
                        </div>
                    </div>
                    <div class="portfolio-item" data-category="dermo">
                        <div style="text-align:center; font-weight:600; margin-bottom:8px;">
                            <span style="display:inline-block; padding:6px 10px; background:#f2f2f2; border-radius:999px; color:#333; font-size:0.95rem;">Après</span>
                        </div>
                        <div class="portfolio-image">
                            <img src="images/image20.jpeg" alt="Après - Reconstruction mammaire" loading="lazy">
                        </div>
                        <div class="portfolio-overlay">
                            <h3>Après</h3>
                            <p>Reconstruction mammaire</p>
                            <a href="#contact" class="portfolio-link"><i class="fas fa-envelope"></i> Demander infos</a>
                        </div>
                    </div>
                </div>

                <div class="portfolio-cta">
                    <p>Pour une prise en charge, contactez-nous</p>
                    <a href="#contact" class="btn btn-primary">Prendre contact</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services">
        <div class="container">
            <h2 class="section-title">Services</h2>
            <p class="section-subtitle">Ce que je peux faire pour vous</p>
            
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-pencil-ruler"></i>
                    </div>
                    <h3>Conception personnalisée</h3>
                    <p>Je crée des designs uniques adaptés à vos envies et à votre personnalité. Chaque tatouage est une œuvre originale.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <h3>Spécialités</h3>
                    <p>Manga, Disney, Pop Culture... Je me spécialise dans vos univers favoris pour créer des tatouages qui vous ressemblent.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Hygiène & Sécurité</h3>
                    <p>Respect strict des normes d'hygiène et de sécurité. Matériel stérilisé et environnement professionnel.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3>Conseil personnalisé</h3>
                    <p>Je vous accompagne dans le choix du design, de la taille et de l'emplacement pour un résultat optimal.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact">
        <div class="container">
            <h2 class="section-title">Contact</h2>
            <p class="section-subtitle">Parlons de votre projet</p>
            
            <div class="contact-content">
                <div class="contact-info">
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="contact-details">
                            <h3>Téléphone</h3>
                            <p><a href="tel:0602120638">0602120638</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fab fa-instagram"></i>
                        </div>
                        <div class="contact-details">
                            <h3>Instagram</h3>
                            <p><a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank">@sinkolor.tattoo</a><br>🤝🏻 Sponsor @hand_ink_</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="contact-details">
                            <h3>Localisation</h3>
                            <p>Toul, France<br>📍</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="contact-details">
                            <h3>Disponibilité</h3>
                            <p>📆 Agenda Décembre/Janvier ouvert<br>⏳ Réponse dans les 24h</p>
                        </div>
                    </div>
                </div>
                
                <div class="contact-form">
                    <h3>Demander un devis</h3>
                    <form id="contactForm" method="POST" action="https://formsubmit.co/lestatouables@gmail.com">
                        <input type="hidden" name="_subject" value="Nouvelle demande de rendez-vous - Les Tatouables">
                        <input type="hidden" name="_template" value="table">
                        <input type="hidden" name="_captcha" value="false">
                        <div class="form-group">
                            <input type="text" id="name" name="name" placeholder="Votre nom" required>
                        </div>
                        <div class="form-group">
                            <input type="email" id="email" name="email" placeholder="Votre email" required>
                        </div>
                        <div class="form-group">
                            <textarea id="message" name="message" placeholder="Décrivez votre projet de tatouage" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Envoyer la demande</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h3>Les Tatouables</h3>
                    <p>Salon de  Tatoueurs Professionnels</p>
                </div>
                <div class="footer-social">
                    <a href="https://www.instagram.com/sinkolor.tattoo/" target="_blank" class="social-link">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Les Tatouables . Tous droits réservés.</p>
            </div>
        </div>
    </footer>

    <!-- Modal: Ajouter des flashs -->
    <div id="flashModal" class="modal" style="display:none;" aria-hidden="true">
        <div class="modal-backdrop"></div>
        <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="flashModalTitle">
            <div class="modal-header">
                <h3 id="flashModalTitle">Ajouter des flashs</h3>
                <button id="flashModalClose" class="modal-close" type="button" aria-label="Fermer">×</button>
            </div>
            <div class="modal-body">
                <div id="flashModalDropzone" class="flash-dropzone">
                    Glissez-déposez des images ici, ou cliquez pour choisir
                </div>
                <input id="flashFileInput" type="file" accept="image/*" multiple style="display:none;">
                <div class="modal-hint">Formats pris en charge: JPG, PNG, WEBP. Déposez plusieurs fichiers si besoin.</div>
            </div>
            <div class="modal-footer">
                <button id="flashModalBrowse" class="btn btn-secondary" type="button">Choisir des fichiers</button>
                <button id="flashModalDone" class="btn btn-primary" type="button">Terminer</button>
            </div>
        </div>
    </div>

    <script>
    (function(){
        // Mot de passe (côté client). Pour plus de sécurité, préférer un backend.
        const ADMIN_PASSWORD = 'tattoo';
        const STORAGE_KEY = 'flashData.v1';
        const grid = document.getElementById('flashGrid');
        const emptyEl = document.getElementById('flashEmpty');
        const toggleBtn = document.getElementById('toggleEditFlash');
        const addBtn = document.getElementById('addFlash');
        // Removed export/import controls
        // Modal elements
        const modal = document.getElementById('flashModal');
        const modalDialog = modal.querySelector('.modal-dialog');
        const modalClose = document.getElementById('flashModalClose');
        const modalDone = document.getElementById('flashModalDone');
        const modalBrowse = document.getElementById('flashModalBrowse');
        const modalDropzone = document.getElementById('flashModalDropzone');
        const fileInput = document.getElementById('flashFileInput');

        let editMode = false;
        let isAuthorized = false;

        function hasSessionAuth(){
            try { return sessionStorage.getItem('flashAuth') === '1'; } catch(e) { return false; }
        }

        function setSessionAuth(on){
            try {
                if (on) sessionStorage.setItem('flashAuth','1');
                else sessionStorage.removeItem('flashAuth');
            } catch(e) {}
        }

        function requestAuth(){
            if (isAuthorized || hasSessionAuth()) { isAuthorized = true; return true; }
            const pwd = prompt('Entrez le mot de passe pour éditer les flashs :');
            if (pwd === ADMIN_PASSWORD){
                isAuthorized = true;
                setSessionAuth(true);
                return true;
            }
            alert('Mot de passe incorrect');
            return false;
        }

        function loadData(){
            const seed = [
                { id: cryptoRandomId(), src: 'images/flash1.jpeg', caption: 'Flash 1' },
                { id: cryptoRandomId(), src: 'images/flash2.jpeg', caption: 'Flash 2' },
                { id: cryptoRandomId(), src: 'images/flash3.jpeg', caption: 'Flash 3' }
            ];
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (raw) {
                    const parsed = JSON.parse(raw);
                    if (Array.isArray(parsed)) {
                        if (parsed.length === 0) {
                            // Seed defaults if empty, so users always see something sans "Éditer"
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(seed));
                            return seed;
                        }
                        return parsed;
                    }
                }
            } catch(e) {}
            // No valid data in storage: seed with defaults
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(seed)); } catch(e) {}
            return seed;
        }

        function saveData(data){
            try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch(e) {}
        }

        function cryptoRandomId(){
            if (window.crypto && crypto.getRandomValues) {
                const buf = new Uint32Array(4);
                crypto.getRandomValues(buf);
                return Array.from(buf).map(x => x.toString(16).padStart(8,'0')).join('');
            }
            return 'id-' + Math.random().toString(36).slice(2) + Date.now().toString(36);
        }

        let data = loadData();

        function render(){
            grid.innerHTML = '';
            if (!data.length){
                emptyEl.style.display = 'block';
                return;
            }
            emptyEl.style.display = 'none';
            for (const item of data){
                const fig = document.createElement('figure');
                fig.className = 'flash-item';

                const img = document.createElement('img');
                img.className = 'flash-img';
                img.src = item.src;
                img.alt = item.caption || 'Tatouage flash';

                const caption = document.createElement('figcaption');
                caption.className = 'flash-caption';
                caption.textContent = item.caption || '';

                const cta = document.createElement('a');
                cta.className = 'btn btn-primary flash-cta';
                cta.href = '#contact';
                cta.textContent = 'Réserver';

                fig.appendChild(img);
                fig.appendChild(caption);
                fig.appendChild(cta);

                if (editMode){
                    const controls = document.createElement('div');
                    controls.style.display = 'flex';
                    controls.style.gap = '8px';
                    controls.style.padding = '0 1rem 1rem';

                    const editButton = document.createElement('button');
                    editButton.className = 'btn btn-secondary';
                    editButton.type = 'button';
                    editButton.textContent = 'Modifier';
                    editButton.addEventListener('click', () => editItem(item.id));

                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'btn btn-secondary';
                    deleteButton.type = 'button';
                    deleteButton.textContent = 'Supprimer';
                    deleteButton.addEventListener('click', () => deleteItem(item.id));

                    controls.appendChild(editButton);
                    controls.appendChild(deleteButton);
                    fig.appendChild(controls);
                }

                grid.appendChild(fig);
            }
        }

        function setEditMode(on){
            editMode = !!on;
            addBtn.style.display = on ? '' : 'none';
            toggleBtn.textContent = on ? 'Terminer' : 'Gérer';
            render();
        }

        function openModal(){
            modal.style.display = '';
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            setTimeout(() => modal.classList.add('is-open'));
        }

        function closeModal(){
            modal.classList.remove('is-open');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
            // small timeout to allow transition if any
            setTimeout(() => { modal.style.display = 'none'; }, 150);
        }

        function editItem(id){
            const idx = data.findIndex(x => x.id === id);
            if (idx === -1) return;
            const current = data[idx];
            const newSrc = prompt('Nouvelle URL de l\'image :', current.src) || current.src;
            const newCaption = prompt('Nouvelle légende :', current.caption || '') || '';
            data[idx] = { ...current, src: newSrc, caption: newCaption };
            saveData(data);
            render();
        }

        function deleteItem(id){
            if (!confirm('Supprimer ce flash ?')) return;
            data = data.filter(x => x.id !== id);
            saveData(data);
            render();
        }

        function exportData(){
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'flash.json';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        }

        function importData(file){
            const reader = new FileReader();
            reader.onload = () => {
                try {
                    const next = JSON.parse(String(reader.result || ''));
                    if (Array.isArray(next)){
                        data = next.map(item => ({ id: item.id || cryptoRandomId(), src: item.src, caption: item.caption || '' }))
                                   .filter(item => typeof item.src === 'string' && item.src);
                        saveData(data);
                        render();
                    } else {
                        alert('Fichier invalide');
                    }
                } catch(e){
                    alert('Échec de l\'import');
                }
            };
            reader.readAsText(file);
        }

        function handleFiles(files){
            const fileArray = Array.from(files || []);
            if (!fileArray.length) return;
            let addedCount = 0;
            let processed = 0;
            fileArray.forEach(file => {
                if (!file.type || !file.type.startsWith('image/')) { processed++; return; }
                const reader = new FileReader();
                reader.onload = () => {
                    const src = String(reader.result || '');
                    if (src) {
                        const baseName = (file.name || '').split('\\').pop().split('/').pop();
                        const nameNoExt = baseName.includes('.') ? baseName.substring(0, baseName.lastIndexOf('.')) : baseName;
                        data.unshift({ id: cryptoRandomId(), src, caption: nameNoExt || 'Flash' });
                        addedCount++;
                    }
                    processed++;
                    if (processed === fileArray.length){
                        if (addedCount){ saveData(data); render(); }
                    }
                };
                reader.onerror = () => { processed++; if (processed === fileArray.length){ if (addedCount){ saveData(data); render(); } } };
                reader.readAsDataURL(file);
            });
        }

        toggleBtn.addEventListener('click', () => {
            if (!editMode) {
                if (!requestAuth()) return;
            }
            setEditMode(!editMode);
        });
        addBtn.addEventListener('click', () => {
            if (!requestAuth()) return;
            openModal();
        });
        // export/import listeners removed

        // Modal events
        modalClose.addEventListener('click', closeModal);
        modalDone.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.style.display !== 'none') closeModal();
        });
        modalBrowse.addEventListener('click', () => fileInput.click());
        modalDropzone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            const files = e.target.files;
            if (files && files.length){ handleFiles(files); }
            fileInput.value = '';
            closeModal();
        });
        ;['dragenter','dragover'].forEach(evt => modalDropzone.addEventListener(evt, (e) => {
            e.preventDefault(); e.stopPropagation();
            modalDropzone.classList.add('is-dragover');
        }));
        ;['dragleave','drop'].forEach(evt => modalDropzone.addEventListener(evt, (e) => {
            e.preventDefault(); e.stopPropagation();
            modalDropzone.classList.remove('is-dragover');
        }));
        modalDropzone.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            if (dt && dt.files){ handleFiles(dt.files); closeModal(); }
        });

        // Protéger aussi les actions Modifier/Supprimer au cas où
        const _editItem = editItem;
        const _deleteItem = deleteItem;
        editItem = function(id){ if (!requestAuth()) return; _editItem(id); };
        deleteItem = function(id){ if (!requestAuth()) return; _deleteItem(id); };

        // Expose for inline handlers si besoin (protégées)
        window.__flashAdmin = { addItem: openModal, editItem, deleteItem };

        render();
    })();
    </script>
</body>
</html>
